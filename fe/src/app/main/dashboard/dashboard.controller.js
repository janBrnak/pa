(function () {
    'use strict';

    angular
        .module('app.dashboard')
        .controller('DashboardController', DashboardController);

    /** @ngInject */
    function DashboardController(paSettingsOfCharts) {
        var vm = this;
        
        // Data
        vm.helloText = "Hello Text"; // DashboardData.data.helloText;
        vm.chartPie = paSettingsOfCharts.pieChartPositions();
        // vm.portfolios = [];
        vm.portfolios = [  // temporary
            {
                id: 1,
                name: 'Portfolio 1',
                date: '2016-01-01',
                data: [
                    { key: 'ABC', value: 5, tooltip: '3,157.29' },
                    { key: 'T', value: 2, tooltip: '3,157.29' },
                    { key: 'NTRS', value: 9, tooltip: '3,157.29' },
                    { key: 'CFN', value: 7, tooltip: '3,157.29' },
                    { key: 'VMC', value: 4, tooltip: '3,157.29' },
                    { key: 'SYMC', value: 3, tooltip: '3,157.29' },
                    { key: 'FSRV', value: 5, tooltip: '3,157.29' }
                ]
            }, {
                id: 2,
                name: 'Portfolio 2',
                date: '2016-01-02',
                data: [
                    { key: 'ABC', value: 5, tooltip: '3,157.29' },
                    { key: 'T', value: 2, tooltip: '3,157.29' },
                    { key: 'NTRS', value: 9, tooltip: '3,157.29' }
                ]
            }, {
                id: 3,
                name: 'Portfolio 3',
                date: '2016-01-01',
                data: [
                    { key: 'ABC', value: 5, tooltip: '3,157.29' },
                    { key: 'T', value: 2, tooltip: '3,157.29' },
                    { key: 'NTRS', value: 9, tooltip: '3,157.29' },
                    { key: 'CFN', value: 7, tooltip: '3,157.29' },
                    { key: 'VMC', value: 4, tooltip: '3,157.29' },
                ]
            }, {
                id: 4,
                name: 'Portfolio 4',
                date: '2016-01-02',
                data: [
                    { key: 'ABC', value: 5, tooltip: '3,157.29' },
                    { key: 'T', value: 2, tooltip: '3,157.29' },
                    { key: 'NTRS', value: 9, tooltip: '3,157.29' },
                    { key: 'CFN', value: 7, tooltip: '3,157.29' },
                    { key: 'VMC', value: 4, tooltip: '3,157.29' },
                    { key: 'SYMC', value: 3, tooltip: '3,157.29' },
                    { key: 'FSRV', value: 5, tooltip: '3,157.29' }
                ]
            },
        ];

        vm.lineChartPortfolio = paSettingsOfCharts.lineChartPortfolio();
        vm.lineChartPortfolioData = [
            {
                "key": "Portfolio 1",
                "values": [
                    {"x": 1, "y": 0},
                    {"x": 2, "y": 1},
                    {"x": 3, "y": 4},
                    {"x": 4, "y": 7},
                    {"x": 5, "y": 7},
                    {"x": 6, "y": 20},
                    {"x": 7, "y": 21},
                    {"x": 8, "y": 40},
                    {"x": 9, "y": 50},
                    {"x": 10, "y": 48},
                    {"x": 11, "y": 63},
                    {"x": 12, "y": 59},
                    {"x": 13, "y": 43},
                    {"x": 14, "y": 54},
                    {"x": 15, "y": 56},
                    {"x": 16, "y": 73},
                    {"x": 17, "y": 71},
                    {"x": 18, "y": 85},
                    {"x": 19, "y": 77},
                    {"x": 20, "y": 95},
                    {"x": 21, "y": 107},
                    {"x": 22, "y": 127},
                    {"x": 23, "y": 122},
                    {"x": 24, "y": 126},
                    {"x": 25, "y": 132},
                    {"x": 26, "y": 120},
                    {"x": 27, "y": 118},
                    {"x": 28, "y": 107},
                    {"x": 29, "y": 110},
                    {"x": 30, "y": 117},
                    {"x": 31, "y": 141},
                    {"x": 32, "y": 159},
                    {"x": 33, "y": 167},
                    {"x": 34, "y": 185},
                    {"x": 35, "y": 184},
                    {"x": 36, "y": 195},
                    {"x": 37, "y": 207},
                    {"x": 38, "y": 230},
                    {"x": 39, "y": 239},
                    {"x": 40, "y": 241},
                    {"x": 41, "y": 239},
                    {"x": 42, "y": 260},
                    {"x": 43, "y": 276},
                    {"x": 44, "y": 258},
                    {"x": 45, "y": 250},
                    {"x": 46, "y": 226},
                    {"x": 47, "y": 227},
                    {"x": 48, "y": 218},
                    {"x": 49, "y": 232},
                    {"x": 50, "y": 253},
                    {"x": 51, "y": 235},
                    {"x": 52, "y": 229},
                    {"x": 53, "y": 225},
                    {"x": 54, "y": 189},
                    {"x": 55, "y": 149},
                    {"x": 56, "y": 131},
                    {"x": 57, "y": 135},
                    {"x": 58, "y": 122},
                    {"x": 59, "y": 97},
                    {"x": 60, "y": 113},
                    {"x": 61, "y": 141},
                    {"x": 62, "y": 142},
                    {"x": 63, "y": 139},
                    {"x": 64, "y": 177},
                    {"x": 65, "y": 194},
                    {"x": 66, "y": 209},
                    {"x": 67, "y": 198},
                    {"x": 68, "y": 222},
                    {"x": 69, "y": 234},
                    {"x": 70, "y": 228},
                    {"x": 71, "y": 248},
                    {"x": 72, "y": 270},
                    {"x": 73, "y": 292},
                    {"x": 74, "y": 265},
                    {"x": 75, "y": 237},
                    {"x": 76, "y": 265},
                    {"x": 77, "y": 248},
                    {"x": 78, "y": 278},
                    {"x": 79, "y": 292},
                    {"x": 80, "y": 300},
                    {"x": 81, "y": 326},
                    {"x": 82, "y": 337},
                    {"x": 83, "y": 339},
                    {"x": 84, "y": 346},
                    {"x": 85, "y": 347},
                    {"x": 86, "y": 342},
                    {"x": 87, "y": 333},
                    {"x": 88, "y": 323},
                    {"x": 89, "y": 295},
                    {"x": 90, "y": 251},
                    {"x": 91, "y": 295},
                    {"x": 92, "y": 294},
                    {"x": 93, "y": 295},
                    {"x": 94, "y": 325},
                    {"x": 95, "y": 340},
                    {"x": 96, "y": 345},
                    {"x": 97, "y": 337},
                    {"x": 98, "y": 318},
                    {"x": 99, "y": 317},
                    {"x": 100, "y": 318},
                    {"x": 101, "y": 332},
                    {"x": 102, "y": 337},
                    {"x": 103, "y": 350},
                    {"x": 104, "y": 349}
                ]
            },
            {
                "key": "Portfolio 2",
                "values": [
                    {"x": 1, "y": 0},
                    {"x": 2, "y": 1},
                    {"x": 3, "y": 1},
                    {"x": 4, "y": 2},
                    {"x": 5, "y": 3},
                    {"x": 6, "y": 13},
                    {"x": 7, "y": 13},
                    {"x": 8, "y": 24},
                    {"x": 9, "y": 34},
                    {"x": 10, "y": 36},
                    {"x": 11, "y": 46},
                    {"x": 12, "y": 43},
                    {"x": 13, "y": 32},
                    {"x": 14, "y": 41},
                    {"x": 15, "y": 40},
                    {"x": 16, "y": 54},
                    {"x": 17, "y": 49},
                    {"x": 18, "y": 61},
                    {"x": 19, "y": 56},
                    {"x": 20, "y": 71},
                    {"x": 21, "y": 78},
                    {"x": 22, "y": 90},
                    {"x": 23, "y": 87},
                    {"x": 24, "y": 87},
                    {"x": 25, "y": 87},
                    {"x": 26, "y": 76},
                    {"x": 27, "y": 72},
                    {"x": 28, "y": 63},
                    {"x": 29, "y": 66},
                    {"x": 30, "y": 75},
                    {"x": 31, "y": 93},
                    {"x": 32, "y": 106},
                    {"x": 33, "y": 116},
                    {"x": 34, "y": 129},
                    {"x": 35, "y": 123},
                    {"x": 36, "y": 129},
                    {"x": 37, "y": 132},
                    {"x": 38, "y": 148},
                    {"x": 39, "y": 157},
                    {"x": 40, "y": 155},
                    {"x": 41, "y": 155},
                    {"x": 42, "y": 159},
                    {"x": 43, "y": 166},
                    {"x": 44, "y": 159},
                    {"x": 45, "y": 151},
                    {"x": 46, "y": 132},
                    {"x": 47, "y": 121},
                    {"x": 48, "y": 112},
                    {"x": 49, "y": 122},
                    {"x": 50, "y": 133},
                    {"x": 51, "y": 120},
                    {"x": 52, "y": 123},
                    {"x": 53, "y": 125},
                    {"x": 54, "y": 103},
                    {"x": 55, "y": 85},
                    {"x": 56, "y": 71},
                    {"x": 57, "y": 71},
                    {"x": 58, "y": 65},
                    {"x": 59, "y": 43},
                    {"x": 60, "y": 57},
                    {"x": 61, "y": 77},
                    {"x": 62, "y": 73},
                    {"x": 63, "y": 70},
                    {"x": 64, "y": 102},
                    {"x": 65, "y": 117},
                    {"x": 66, "y": 128},
                    {"x": 67, "y": 119},
                    {"x": 68, "y": 139},
                    {"x": 69, "y": 149},
                    {"x": 70, "y": 144},
                    {"x": 71, "y": 161},
                    {"x": 72, "y": 180},
                    {"x": 73, "y": 199},
                    {"x": 74, "y": 180},
                    {"x": 75, "y": 158},
                    {"x": 76, "y": 177},
                    {"x": 77, "y": 162},
                    {"x": 78, "y": 183},
                    {"x": 79, "y": 194},
                    {"x": 80, "y": 201},
                    {"x": 81, "y": 222},
                    {"x": 82, "y": 233},
                    {"x": 83, "y": 231},
                    {"x": 84, "y": 237},
                    {"x": 85, "y": 235},
                    {"x": 86, "y": 232},
                    {"x": 87, "y": 226},
                    {"x": 88, "y": 219},
                    {"x": 89, "y": 198},
                    {"x": 90, "y": 168},
                    {"x": 91, "y": 202},
                    {"x": 92, "y": 203},
                    {"x": 93, "y": 204},
                    {"x": 94, "y": 229},
                    {"x": 95, "y": 239},
                    {"x": 96, "y": 242},
                    {"x": 97, "y": 234},
                    {"x": 98, "y": 221},
                    {"x": 99, "y": 216},
                    {"x": 100, "y": 218},
                    {"x": 101, "y": 229},
                    {"x": 102, "y": 230},
                    {"x": 103, "y": 243},
                    {"x": 104, "y": 244}
                ]
            },
            {
                "key": "Portfolio 3",
                "values": [
                    {"x": 1, "y": 0},
                    {"x": 2, "y": 1},
                    {"x": 3, "y": 2},
                    {"x": 4, "y": 2},
                    {"x": 5, "y": 3},
                    {"x": 6, "y": 3},
                    {"x": 7, "y": 4},
                    {"x": 8, "y": 5},
                    {"x": 9, "y": 9},
                    {"x": 10, "y": 6},
                    {"x": 11, "y": 9},
                    {"x": 12, "y": 7},
                    {"x": 13, "y": 4},
                    {"x": 14, "y": 8},
                    {"x": 15, "y": 9},
                    {"x": 16, "y": 13},
                    {"x": 17, "y": 12},
                    {"x": 18, "y": 13},
                    {"x": 19, "y": 11},
                    {"x": 20, "y": 15},
                    {"x": 21, "y": 15},
                    {"x": 22, "y": 19},
                    {"x": 23, "y": 19},
                    {"x": 24, "y": 21},
                    {"x": 25, "y": 22},
                    {"x": 26, "y": 19},
                    {"x": 27, "y": 19},
                    {"x": 28, "y": 19},
                    {"x": 29, "y": 22},
                    {"x": 30, "y": 24},
                    {"x": 31, "y": 29},
                    {"x": 32, "y": 31},
                    {"x": 33, "y": 33},
                    {"x": 34, "y": 35},
                    {"x": 35, "y": 33},
                    {"x": 36, "y": 34},
                    {"x": 37, "y": 40},
                    {"x": 38, "y": 45},
                    {"x": 39, "y": 43},
                    {"x": 40, "y": 38},
                    {"x": 41, "y": 40},
                    {"x": 42, "y": 45},
                    {"x": 43, "y": 48},
                    {"x": 44, "y": 41},
                    {"x": 45, "y": 40},
                    {"x": 46, "y": 32},
                    {"x": 47, "y": 28},
                    {"x": 48, "y": 27},
                    {"x": 49, "y": 33},
                    {"x": 50, "y": 36},
                    {"x": 51, "y": 25},
                    {"x": 52, "y": 23},
                    {"x": 53, "y": 25},
                    {"x": 54, "y": 14},
                    {"x": 55, "y": 13},
                    {"x": 56, "y": 12},
                    {"x": 57, "y": 11},
                    {"x": 58, "y": 18},
                    {"x": 59, "y": 23},
                    {"x": 60, "y": 20},
                    {"x": 61, "y": 12},
                    {"x": 62, "y": 8},
                    {"x": 63, "y": 7},
                    {"x": 64, "y": 0},
                    {"x": 65, "y": 2},
                    {"x": 66, "y": 6},
                    {"x": 67, "y": 4},
                    {"x": 68, "y": 10},
                    {"x": 69, "y": 13},
                    {"x": 70, "y": 9},
                    {"x": 71, "y": 12},
                    {"x": 72, "y": 19},
                    {"x": 73, "y": 22},
                    {"x": 74, "y": 12},
                    {"x": 75, "y": 6},
                    {"x": 76, "y": 13},
                    {"x": 77, "y": 8},
                    {"x": 78, "y": 18},
                    {"x": 79, "y": 23},
                    {"x": 80, "y": 23},
                    {"x": 81, "y": 31},
                    {"x": 82, "y": 34},
                    {"x": 83, "y": 39},
                    {"x": 84, "y": 40},
                    {"x": 85, "y": 44},
                    {"x": 86, "y": 42},
                    {"x": 87, "y": 40},
                    {"x": 88, "y": 37},
                    {"x": 89, "y": 29},
                    {"x": 90, "y": 19},
                    {"x": 91, "y": 33},
                    {"x": 92, "y": 32},
                    {"x": 93, "y": 34},
                    {"x": 94, "y": 40},
                    {"x": 95, "y": 46},
                    {"x": 96, "y": 51},
                    {"x": 97, "y": 50},
                    {"x": 98, "y": 41},
                    {"x": 99, "y": 46},
                    {"x": 100, "y": 48},
                    {"x": 101, "y": 51},
                    {"x": 102, "y": 55},
                    {"x": 103, "y": 52},
                    {"x": 104, "y": 49}
                ]
            }
        ];
        // Methods

        //////////

        /* Random Data Generator (took from nvd3.org) */
        function generateData() {
            return stream_layers(4,10+Math.random()*200,.1).map(function(data, i) {
                return {
                    key: 'Portfolio ' + (i+1),
                    values: data
                };
            });
        }

        /* Inspired by Lee Byron's test data generator. */
        function stream_layers(n, m, o) {
            if (arguments.length < 3) o = 0;
            function bump(a) {
                var x = 1 / (.1 + Math.random()),
                    y = 2 * Math.random() - .5,
                    z = 10 / (.1 + Math.random());
                for (var i = 0; i < m; i++) {
                    var w = (i / m - y) * z;
                    a[i] += x * Math.exp(-w * w);
                }
            }
            return d3.range(n).map(function() {
                var a = [], i;
                for (i = 0; i < m; i++) a[i] = o + o * Math.random();
                for (i = 0; i < 5; i++) bump(a);
                return a.map(stream_index);
            });
        }

        /* Another layer generator using gamma distributions. */
        function stream_waves(n, m) {
            return d3.range(n).map(function(i) {
                return d3.range(m).map(function(j) {
                    var x = 20 * j / m - i / 3;
                    return 2 * x * Math.exp(-.5 * x);
                }).map(stream_index);
            });
        }

        function stream_index(d, i) {
            return {x: i, y: Math.max(0, d)};
        }
    }
})();
